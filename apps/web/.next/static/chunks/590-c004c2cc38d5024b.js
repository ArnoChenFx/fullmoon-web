"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[590],{4472:(e,t,a)=>{a.d(t,{ChatInterface:()=>F});var s=a(6444),n=a(1751),r=a(2356),o=a(1322),c=a(2784),l=a(5467),i=a(9841),d=a(2846),u=a(208),x=a(5475);function f(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,x.QP)((0,u.$)(t))}let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("textarea",{className:f("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});h.displayName="Textarea";var m=a(6973);let g=(0,a(498).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),p=n.forwardRef((e,t)=>{let{className:a,variant:n,size:r,asChild:o=!1,...c}=e,l=o?m.DX:"button";return(0,s.jsx)(l,{className:f(g({variant:n,size:r,className:a})),ref:t,...c})});p.displayName="Button";var v=a(4322),b=a(1624),w=a(4874);let y={NEW:"new",WAXING_CRESCENT:"waxing-crescent",FIRST_QUARTER:"first-quarter",WAXING_GIBBOUS:"waxing-gibbous",FULL:"full",WANING_GIBBOUS:"waning-gibbous",LAST_QUARTER:"last-quarter",WANING_CRESCENT:"waning-crescent"};function N(e){let{phase:t,size:a=24,color:n="currentColor"}=e;return(0,s.jsx)("svg",{width:a,height:a,viewBox:"0 0 ".concat(a," ").concat(a),fill:"none",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-label":"Moon phase: ".concat(t),children:(()=>{switch(t){case y.NEW:return(0,s.jsx)("circle",{cx:a/2,cy:a/2,r:a/2-1,fill:"none",stroke:n});case y.WAXING_CRESCENT:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,1 ").concat(a/2,",").concat(a-1," A").concat(a/4,",").concat(a/2-1," 0 1,0 ").concat(a/2,",1"),fill:n});case y.FIRST_QUARTER:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,1 ").concat(a/2,",").concat(a-1," L").concat(a/2,",1"),fill:n});case y.WAXING_GIBBOUS:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,1 ").concat(a/2,",").concat(a-1," A").concat(a/4,",").concat(a/2-1," 0 0,1 ").concat(a/2,",1"),fill:n});case y.FULL:return(0,s.jsx)("circle",{cx:a/2,cy:a/2,r:a/2-1,fill:n,stroke:"none"});case y.WANING_GIBBOUS:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,0 ").concat(a/2,",").concat(a-1," A").concat(a/4,",").concat(a/2-1," 0 0,0 ").concat(a/2,",1"),fill:n});case y.LAST_QUARTER:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,0 ").concat(a/2,",").concat(a-1," L").concat(a/2,",1"),fill:n});case y.WANING_CRESCENT:return(0,s.jsx)("path",{d:"M".concat(a/2,",1 A").concat(a/2-1,",").concat(a/2-1," 0 1,0 ").concat(a/2,",").concat(a-1," A").concat(a/4,",").concat(a/2-1," 0 1,1 ").concat(a/2,",1"),fill:n});default:return null}})()})}var j=a(1129),A=a(2909);let C=j.bL;j.l9;let k=j.ZL;j.bm;let S=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(j.hJ,{ref:t,className:f("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});S.displayName=j.hJ.displayName;let E=n.forwardRef((e,t)=>{let{className:a,children:n,...r}=e;return(0,s.jsxs)(k,{children:[(0,s.jsx)(S,{}),(0,s.jsxs)(j.UC,{ref:t,className:f("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...r,children:[n,(0,s.jsxs)(j.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(A.MKb,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});E.displayName=j.UC.displayName;let I=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:f("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};I.displayName="DialogHeader";let R=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(j.hE,{ref:t,className:f("text-lg font-semibold leading-none tracking-tight",a),...n})});R.displayName=j.hE.displayName;let _=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(j.VY,{ref:t,className:f("text-sm text-muted-foreground",a),...n})});_.displayName=j.VY.displayName;var M=a(3175),T=a(290),G=a(436);function D(){let{setTheme:e,theme:t}=(0,G.D)();return(0,s.jsxs)(p,{variant:"ghost",size:"icon",onClick:()=>e("light"===t?"dark":"light"),children:[(0,s.jsx)(M.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,s.jsx)(T.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}function U(e){let{open:t,onOpenChange:a}=e;return(0,s.jsx)(C,{open:t,onOpenChange:a,children:(0,s.jsxs)(E,{children:[(0,s.jsxs)(I,{children:[(0,s.jsx)(R,{children:"Settings"}),(0,s.jsx)(_,{children:"Customize your chat experience."})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("label",{htmlFor:"theme-toggle",className:"text-sm font-medium leading-none",children:"Theme"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Switch between light and dark mode."})]}),(0,s.jsx)(D,{})]})})]})})}let z=new(a(2649)).X;function F(e){let{convo:t}=e,[a,u]=(0,n.useState)(!1),{isSidebarOpen:x,toggleSidebar:f}=(0,w.c)(),m=(0,v.useRouter)(),[g,j]=(0,n.useState)((null==t?void 0:t.id)||null),[,A]=(0,n.useState)(t||null),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{(null==t?void 0:t.id)&&(j(t.id),A(t))},[t]);let{messages:k,input:S,handleInputChange:E,handleSubmit:I,isLoading:R}=(0,r.Y_)({initialMessages:(null==t?void 0:t.messages)||[],body:{conversationId:g},id:g||"new",onFinish:async e=>{if(g)try{await z.createMessage({content:e.content,role:"assistant",conversationId:g,createdAt:new Date})}catch(e){console.error("Failed to save assistant message:",e)}}}),_=(0,n.useCallback)(()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[]);(0,n.useEffect)(()=>{k.length>0&&_()},[k,_]),(0,n.useEffect)(()=>{g&&S.trim()&&I(new Event("submit"))},[g]);let M=async e=>{if(e.preventDefault(),!S.trim()||R)return;let t=S.trim();if(g)try{await z.createMessage({content:t,role:"user",conversationId:g,createdAt:new Date})}catch(e){console.error("Failed to save user message:",e)}else try{let e=await z.createConversation({title:t.slice(0,80),createdAt:new Date,updatedAt:new Date});await z.createMessage({content:t,role:"user",conversationId:e.id,createdAt:new Date}),j(e.id),m.replace("/c/".concat(e.id));return}catch(e){console.error("Failed to create conversation:",e)}I(e)};return(0,s.jsxs)("div",{className:"flex-1 flex justify-center transition-all duration-200 ease-in-out ".concat(x?"pl-64":"pl-0"),children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 p-4 bg-background border-b text-center",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-6 transition-all duration-200 ease-in-out ".concat(x?"ml-64":"ml-20"),children:[(0,s.jsx)("h1",{className:"text-md font-bold",children:(null==t?void 0:t.title)||"chat"}),(0,s.jsx)(p,{variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-300",onClick:()=>u(!0),children:(0,s.jsx)(o.A,{className:"h-3 w-3"})})]})}),(0,s.jsxs)("div",{className:"fixed top-4 left-4 z-40 flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:f,className:"p-2 rounded-full bg-secondary hover:bg-secondary/80",children:(0,s.jsx)(c.A,{className:"h-3 w-3"})}),(0,s.jsx)(b.default,{href:"/",className:"p-2 hover:rounded-full hover:bg-secondary/80",children:(0,s.jsx)(l.A,{className:"h-3 w-3"})})]}),(0,s.jsxs)("main",{className:"w-full max-w-2xl p-4 mt-16 mb-16",children:[0===k.length?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center h-[calc(100vh-200px)]",children:(0,s.jsx)(N,{phase:(()=>{switch(function(){let e=new Date,t=e.getFullYear(),a=e.getMonth()+1,s=((367*t-Math.floor(7*(t+Math.floor((a+9)/12))/4)+Math.floor(275*a/9)+e.getDate()-730530)%29.53+29.53)%29.53;return s<1.84566?"new":s<5.53699?"waxing-crescent":s<9.22831?"first-quarter":s<12.91963?"waxing-gibbous":s<16.61096?"full":s<20.30228?"waning-gibbous":s<23.99361?"last-quarter":s<27.68493?"waning-crescent":"new"}()){case"new":default:return y.NEW;case"waxing-crescent":return y.WAXING_CRESCENT;case"first-quarter":return y.FIRST_QUARTER;case"waxing-gibbous":return y.WAXING_GIBBOUS;case"full":return y.FULL;case"waning-gibbous":return y.WANING_GIBBOUS;case"last-quarter":return y.LAST_QUARTER;case"waning-crescent":return y.WANING_CRESCENT}})(),size:48,color:"currentColor"})}):(0,s.jsx)("div",{className:"space-y-4",children:k.map((e,t)=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsx)("div",{className:"max-w-[80%] rounded-3xl px-4 py-2 ".concat("user"===e.role?"bg-secondary text-foreground":"text-foreground"),children:(0,s.jsxs)("p",{className:"whitespace-pre-wrap",children:[e.content,R&&t===k.length-1&&"assistant"===e.role&&"\uD83C\uDF15"]})})},e.id))}),(0,s.jsx)("div",{ref:C})]}),(0,s.jsx)("div",{className:"fixed bottom-0 w-full bg-background",children:(0,s.jsx)("form",{onSubmit:M,className:"relative",children:(0,s.jsx)("div",{className:"max-w-2xl mx-auto w-full",children:(0,s.jsxs)("div",{className:"flex flex-col m-4 px-2 py-1 bg-secondary rounded-3xl",children:[(0,s.jsx)(h,{value:S,onChange:E,placeholder:"ask me anything...",rows:1,onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M(e))},className:"w-full border-none text-foreground placeholder:text-gray-400 resize-none focus-visible:ring-0 focus-visible:ring-offset-0 min-h-[36px] align-middle shadow-none"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-0",children:(0,s.jsx)(p,{type:"button",variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-300",children:(0,s.jsx)(i.A,{className:"h-5 w-5"})})}),(0,s.jsx)(p,{type:"submit",variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-300",disabled:R||!S.trim(),children:(0,s.jsx)(d.A,{className:"h-5 w-5"})})]})]})})})}),(0,s.jsx)(U,{open:a,onOpenChange:u})]})}},4115:(e,t,a)=>{a.d(t,{ChatSidebar:()=>x});var s=a(6444),n=a(1751),r=a(1624),o=a(2784),c=a(5467),l=a(2212),i=a(4874),d=a(4322);let u=new(a(2649)).X;function x(){let{isSidebarOpen:e,setIsSidebarOpen:t}=(0,i.c)(),[a,x]=(0,n.useState)([]),f=(0,d.usePathname)(),h=(0,d.useRouter)(),m=(0,n.useCallback)(async()=>{x(await u.listConversations())},[]);(0,n.useEffect)(()=>{m()},[m]);let g=async(e,t)=>{t.preventDefault();try{await u.deleteConversation(e),f==="/c/".concat(e)&&h.replace("/"),await m()}catch(e){console.error("Failed to delete conversation:",e)}};return(0,s.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-background border-r transform transition-transform duration-200 ease-in-out ".concat(e?"translate-x-0":"-translate-x-full"),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>t(!1),className:"p-2 rounded-full bg-secondary hover:bg-secondary/80",children:(0,s.jsx)(o.A,{className:"h-3 w-3"})}),(0,s.jsx)(r.default,{href:"/",className:"p-2 rounded-full hover:rounded-full hover:bg-secondary/80",children:(0,s.jsx)(c.A,{className:"h-3 w-3"})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)("div",{className:"p-4 space-y-2",children:a.map(e=>(0,s.jsxs)(r.default,{href:"/c/".concat(e.id),className:"group block p-2 rounded-lg hover:bg-secondary/80 transition-colors relative",children:[(0,s.jsxs)("div",{className:"text-sm",children:[e.title,(0,s.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,s.jsx)("button",{type:"button",onClick:t=>g(e.id,t),className:"absolute right-2 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 p-1 hover:bg-destructive/10 rounded transition-opacity",children:(0,s.jsx)(l.A,{className:"h-4 w-4 text-destructive"})})]},e.id))})})]})})}},4874:(e,t,a)=>{a.d(t,{SidebarProvider:()=>o,c:()=>c});var s=a(6444),n=a(1751);let r=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,n.useState)(!0);return(0,s.jsx)(r.Provider,{value:{isSidebarOpen:a,toggleSidebar:()=>{o(!a)},setIsSidebarOpen:o},children:t})}function c(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useSidebar must be used within a SidebarProvider");return e}},2649:(e,t,a)=>{a.d(t,{X:()=>o});var s=a(340),n=a(7268);async function r(){return(0,s.P2)("fullmoon-db",1,{upgrade(e){e.createObjectStore("conversations",{keyPath:"id"}).createIndex("by-updated","updatedAt"),e.createObjectStore("messages",{keyPath:"id"}).createIndex("by-conversation","conversationId")}})}class o{async createConversation(e){let t=await r(),a={...e,id:(0,n.A)()};return await t.add("conversations",a),a}async getConversation(e){let t=await r();return await t.get("conversations",e)||null}async listConversations(){let e=await r();return await e.getAllFromIndex("conversations","by-updated")||[]}async updateConversation(e,t){let a=await r(),s=await this.getConversation(e);if(!s)throw Error("Conversation not found: ".concat(e));let n={...s,...t,updatedAt:new Date};return await a.put("conversations",n),n}async deleteConversation(e){let t=await r();await t.delete("conversations",e);let a=await this.getMessages(e);await Promise.all(a.map(e=>this.deleteMessage(e.id)))}async createMessage(e){let t=await r(),a={...e,id:(0,n.A)()};return await t.add("messages",a),a}async getMessages(e){return(await r()).getAllFromIndex("messages","by-conversation",e)}async deleteMessage(e){let t=await r();await t.delete("messages",e)}}}}]);